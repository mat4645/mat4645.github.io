<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="index,follow" />

  <title>CSV→JSON 変換ツール（Shift-JIS/UTF-8/UTF-16対応・無料・ブラウザ完結） | ToolBox</title>
  <meta name="description" content="CSVをJSONに変換できます。貼り付け/ファイル選択に対応。Shift-JIS/UTF-8/UTF-16の読み込み指定が可能。データはブラウザ内で処理され、サーバーに送信しません。" />
  <link rel="canonical" href="https://mat4645.github.io/tools/csv-to-json/" />

  <style>
    :root{
      --bg:#ffffff; --fg:#111827; --muted:#6b7280; --border:#e5e7eb;
      --shadow: 0 10px 25px rgba(0,0,0,.06);
      --radius:14px; --accent:#2563eb; --danger:#dc2626; --ok:#16a34a;
      --max: 980px; --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:var(--sans); color:var(--fg); background:linear-gradient(180deg,#fff,#fff 30%, #f7f8fb);}
    a{color:var(--accent); text-decoration:none} a:hover{text-decoration:underline}
    header{position:sticky; top:0; z-index:10; background:rgba(255,255,255,.86); backdrop-filter: blur(8px); border-bottom:1px solid var(--border);}
    .wrap{max-width:var(--max); margin:0 auto; padding:14px 16px}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px}
    .logo{width:34px; height:34px; border-radius:10px; background: radial-gradient(circle at 30% 30%, #93c5fd, #2563eb); box-shadow: var(--shadow);}
    .brand strong{font-size:15px}
    .nav{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .nav a{font-size:13px; color:var(--muted)} .nav a:hover{color:var(--fg); text-decoration:none}
    main{padding:18px 0 38px}
    .hero{display:grid; gap:10px; padding:18px 16px 0}
    h1{margin:0; font-size:26px; letter-spacing:-.02em}
    .sub{color:var(--muted); line-height:1.7; margin:0}
    .pill{font-size:12px; color:var(--muted); background:#f3f4f6; border:1px solid var(--border); padding:6px 10px; border-radius:999px; display:inline-block}
    .grid{display:grid; grid-template-columns:1fr; gap:14px; margin-top:14px; padding:0 16px}
    @media (min-width: 980px){ .grid{grid-template-columns: 2fr 1fr;} }
    .card{background:var(--bg); border:1px solid var(--border); border-radius:var(--radius); box-shadow: var(--shadow); overflow:hidden;}
    .hd{padding:12px 14px; border-bottom:1px solid var(--border); background:linear-gradient(180deg,#fff,#fbfbff); display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .hd .title{font-weight:700; font-size:14px}
    .bd{padding:14px}
    textarea{width:100%; min-height:180px; padding:12px; border-radius:12px; border:1px solid var(--border); background:#fff; resize:vertical; font-family:var(--mono); font-size:13px; line-height:1.6; outline:none;}
    textarea:focus{border-color:#93c5fd; box-shadow: 0 0 0 4px rgba(59,130,246,.12);}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{border:1px solid var(--border); background:#fff; padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:600; font-size:13px}
    .btn.primary{border-color:#2563eb; background:#2563eb; color:#fff}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .msg{font-size:13px; color:var(--muted); line-height:1.6}
    .ok{color:var(--ok)} .ng{color:var(--danger)}
    .small{font-size:12px; color:var(--muted); line-height:1.7}
    select, input[type="number"]{border:1px solid var(--border); border-radius:10px; padding:8px 10px; background:#fff; font-size:13px}
    input[type="file"]{font-size:13px}
    pre{white-space:pre-wrap; font-family:var(--mono); font-size:12px; border:1px solid var(--border); border-radius:12px; padding:10px; background:#fff; min-height:120px;}
    .hint{font-size:12px; color:var(--muted); margin-top:6px}
  </style>
</head>

<body>
<header>
  <div class="wrap topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <strong>ToolBox</strong><div class="small">1ページ完結の無料ツール集</div>
      </div>
    </div>
    <nav class="nav">
      <a href="/">ホーム</a>
      <a href="/tools/">ツール一覧</a>
      <a href="/about/">このサイトについて</a>
      <a href="/privacy/">プライバシーポリシー</a>
    </nav>
  </div>
</header>

<main>
  <section class="hero wrap">
    <h1>CSV→JSON 変換ツール（文字コード指定対応）</h1>
    <p class="sub">
      CSVを貼り付けるか、ファイルを選択して変換できます。<strong>文字コードを切り替えると自動で再読み込み・プレビュー更新</strong>します。<br/>
      <span class="pill">このページ内で処理（サーバーに送信しません）</span>
    </p>
  </section>

  <section class="grid wrap">
    <div class="card">
      <div class="hd">
        <div class="title">変換</div>
      </div>
      <div class="bd">

        <div class="row" style="justify-content:space-between">
          <div class="row">
            <label class="small">区切り文字：</label>
            <select id="delimiter">
              <option value="," selected>カンマ (,)</option>
              <option value="tab">タブ (\\t)</option>
              <option value=";">セミコロン (;)</option>
            </select>

            <label class="small" style="margin-left:8px">
              <input type="checkbox" id="hasHeader" checked />
              1行目はヘッダ
            </label>
          </div>

          <div class="row">
            <label class="small">
              ファイル文字コード：
              <select id="fileEncoding">
                <option value="shift_jis" selected>Shift-JIS</option>
                <option value="utf-8">UTF-8</option>
                <option value="utf-8-bom">UTF-8（BOM付き）</option>
                <option value="utf-16le">UTF-16LE</option>
                <option value="utf-16be">UTF-16BE</option>
              </select>
            </label>

            <label class="small" style="margin-left:8px">
              CSVファイル：
              <input type="file" id="fileInput" accept=".csv,.txt" />
            </label>
          </div>
        </div>

        <label class="small" style="display:block;margin-top:10px">CSV入力（貼り付け）</label>
        <textarea id="inputText"></textarea>

        <div class="row" style="margin-top:10px">
          <button class="btn primary" id="btnRun">JSONに変換</button>
          <span class="msg" id="msg"></span>
        </div>

        <textarea id="outputText" readonly></textarea>
      </div>
    </div>

    <aside class="card">
      <div class="hd"><div class="title">プレビュー</div></div>
      <div class="bd">
        <pre id="previewBox"></pre>
      </div>
    </aside>
  </section>
</main>

<script>
  const $ = id => document.getElementById(id);
  const inputEl = $("inputText");
  const outputEl = $("outputText");
  const previewEl = $("previewBox");
  const msgEl = $("msg");
  const delimiterEl = $("delimiter");
  const hasHeaderEl = $("hasHeader");
  const fileInputEl = $("fileInput");
  const fileEncodingEl = $("fileEncoding");

  let lastSelectedFile = null;

  function setMsg(t,k){msgEl.textContent=t||"";msgEl.className="msg "+(k||"");}

  function decodeArrayBuffer(buf, enc){
    const e = enc === "utf-8-bom" ? "utf-8" : enc;
    let t = new TextDecoder(e).decode(buf);
    if (t.startsWith("\uFEFF")) t = t.slice(1);
    return t.replace(/\u0000/g,"");
  }

  function parseCSV(text, delim){
    const d = delim==="tab" ? "\t" : delim;
    return text.replace(/\r\n/g,"\n").replace(/\r/g,"\n")
      .split("\n").filter(l=>l.trim()!=="").map(l=>l.split(d));
  }

  function runConvert(){
    const csv = inputEl.value.trim();
    if(!csv){ setMsg("CSVが空です","ng"); return; }

    const rows = parseCSV(csv, delimiterEl.value);
    let headers=[], start=0;
    if(hasHeaderEl.checked){ headers=rows[0]; start=1; }
    else { headers=rows[0].map((_,i)=>"col"+(i+1)); }

    const json = rows.slice(start).map(r=>{
      const o={}; headers.forEach((h,i)=>o[h]=r[i]??""); return o;
    });

    outputEl.value = JSON.stringify(json,null,2);
    previewEl.textContent = JSON.stringify(json.slice(0,3),null,2);
    setMsg("変換しました","ok");
  }

  async function reloadFileAndPreview(){
    if(!lastSelectedFile) return;
    const ab = await lastSelectedFile.arrayBuffer();
    inputEl.value = decodeArrayBuffer(ab, fileEncodingEl.value);
    setMsg(`再読み込み：${lastSelectedFile.name}`);
    runConvert();
  }

  fileInputEl.addEventListener("change", async e=>{
    lastSelectedFile = e.target.files[0] || null;
    if(lastSelectedFile) await reloadFileAndPreview();
  });

  fileEncodingEl.addEventListener("change", reloadFileAndPreview);
  $("btnRun").addEventListener("click", runConvert);
</script>
</body>
</html>
