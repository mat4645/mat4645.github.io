<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>CSV→JSON 変換ツール（Shift-JIS/UTF-8/UTF-16対応・無料・ブラウザ完結） | ToolBox</title>
  <meta name="description" content="CSVをJSONに変換できます。貼り付け/ファイル選択に対応。Shift-JIS/UTF-8/UTF-16の読み込み指定が可能。データはブラウザ内で処理され、サーバーに送信しません。" />
  <link rel="canonical" href="https://mat4645.github.io/tools/csv-to-json/" />

  <style>
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",sans-serif;background:#f7f8fb;color:#111827}
    header,main{max-width:980px;margin:0 auto;padding:14px 16px}
    header{background:#fff;border-bottom:1px solid #e5e7eb;position:sticky;top:0}
    a{color:#2563eb;text-decoration:none}
    textarea{width:100%;min-height:180px;border:1px solid #e5e7eb;border-radius:12px;padding:12px;font-family:Consolas,monospace;font-size:13px}
    select,input[type="file"]{font-size:13px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 10px 25px rgba(0,0,0,.06);padding:14px;margin-top:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    button{border:1px solid #e5e7eb;background:#fff;padding:10px 12px;border-radius:12px;font-weight:600;cursor:pointer}
    button.primary{background:#2563eb;color:#fff;border-color:#2563eb}
    .msg{font-size:13px;color:#6b7280}
    .ok{color:#16a34a}.ng{color:#dc2626}
    pre{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:10px;font-size:12px}
  </style>
</head>

<body>
<header>
  <strong>ToolBox</strong> / CSV→JSON
</header>

<main>
  <h1>CSV→JSON 変換</h1>
  <p class="msg">文字コードを指定してCSVをJSONに変換します（ブラウザ内処理）。</p>

  <div class="card">
    <div class="row">
      <label>区切り：
        <select id="delimiter">
          <option value=",">カンマ</option>
          <option value="tab">タブ</option>
          <option value=";">セミコロン</option>
        </select>
      </label>

      <label>
        <input type="checkbox" id="hasHeader" checked /> 1行目はヘッダ
      </label>

      <label>文字コード：
        <select id="fileEncoding">
          <option value="shift_jis" selected>Shift-JIS</option>
          <option value="utf-8">UTF-8</option>
          <option value="utf-8-bom">UTF-8(BOM)</option>
          <option value="utf-16le">UTF-16LE</option>
          <option value="utf-16be">UTF-16BE</option>
        </select>
      </label>

      <input type="file" id="fileInput" accept=".csv,.txt" />
    </div>

    <textarea id="inputText" placeholder="CSVを貼り付けるか、ファイルを選択"></textarea>

    <div class="row">
      <button class="primary" id="btnRun">JSONに変換</button>
      <span class="msg" id="msg"></span>
    </div>

    <textarea id="outputText" readonly placeholder="JSON結果"></textarea>
  </div>

  <div class="card">
    <h3>プレビュー</h3>
    <pre id="preview"></pre>
  </div>
</main>

<script>
  const $ = id => document.getElementById(id);

  const inputEl = $("inputText");
  const outputEl = $("outputText");
  const previewEl = $("preview");
  const msgEl = $("msg");

  const delimiterEl = $("delimiter");
  const hasHeaderEl = $("hasHeader");
  const fileInputEl = $("fileInput");
  const fileEncodingEl = $("fileEncoding");

  let lastSelectedFile = null;

  function setMsg(t,k){msgEl.textContent=t||"";msgEl.className="msg "+(k||"");}

  function decodeArrayBuffer(buf, encSel){
    const enc = encSel === "utf-8-bom" ? "utf-8" : encSel;
    let text = new TextDecoder(enc).decode(buf);
    if (text.startsWith("\uFEFF")) text = text.slice(1);
    return text.replace(/\u0000/g,"");
  }

  function parseCSV(text, delim){
    const d = delim==="tab" ? "\t" : delim;
    const lines = text.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n");
    return lines.filter(l=>l.trim()!=="").map(l=>l.split(d));
  }

  function runConvert(){
    const csv = inputEl.value.trim();
    if(!csv){setMsg("CSVが空です","ng");return;}

    const rows = parseCSV(csv, delimiterEl.value);
    if(!rows.length){setMsg("解析できません","ng");return;}

    let headers=[], start=0;
    if(hasHeaderEl.checked){
      headers = rows[0];
      start = 1;
    }else{
      headers = rows[0].map((_,i)=>"col"+(i+1));
    }

    const json = rows.slice(start).map(r=>{
      const o={};
      headers.forEach((h,i)=>o[h]=r[i]??"");
      return o;
    });

    outputEl.value = JSON.stringify(json,null,2);
    previewEl.textContent =
      `行数: ${json.length}\n---\n`+
      JSON.stringify(json.slice(0,3),null,2);

    setMsg("変換しました","ok");
  }

  async function loadSelectedFileAndPreview(){
    if(!lastSelectedFile) return;
    const ab = await lastSelectedFile.arrayBuffer();
    inputEl.value = decodeArrayBuffer(ab, fileEncodingEl.value);
    setMsg(`読み込み：${lastSelectedFile.name}`);
    runConvert();
  }

  fileInputEl.addEventListener("change", async e=>{
    lastSelectedFile = e.target.files[0] || null;
    if(lastSelectedFile) await loadSelectedFileAndPreview();
  });

  fileEncodingEl.addEventListener("change", async ()=>{
    await loadSelectedFileAndPreview();
  });

  $("btnRun").addEventListener("click", runConvert);
</script>
</body>
</html>
