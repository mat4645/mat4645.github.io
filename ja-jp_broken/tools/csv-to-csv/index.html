<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="index,follow" />

  <title>CSV竊辰SV 譁・ｭ励さ繝ｼ繝牙､画鋤繝・・繝ｫ・・hift-JIS / UTF-8・・| ConvertFileBox</title>
  <meta name="description"
    content="CSV繝輔ぃ繧､繝ｫ縺ｮ譁・ｭ励さ繝ｼ繝峨ｒ螟画鋤縺励※蜀阪ム繧ｦ繝ｳ繝ｭ繝ｼ繝峨りｪｭ縺ｿ霎ｼ縺ｿ譎・譖ｸ縺榊・縺玲凾縺ｮ譁・ｭ励さ繝ｼ繝会ｼ・hift-JIS / UTF-8 / UTF-8 BOM・峨ｒ謖・ｮ壼庄閭ｽ縲・xcel縺ｧ隱ｭ繧√↑縺ФTF-8 BOM莉倥″CSV繧担hift-JIS縺ｫ螟画鋤縺励◆縺・ｴ蜷医↓萓ｿ蛻ｩ縲ら┌譁吶・繝悶Λ繧ｦ繧ｶ螳檎ｵ舌〒繧ｵ繝ｼ繝舌・騾∽ｿ｡縺ｪ縺励・ />
  <link rel="canonical" href="https://www.convertfilebox.net/ja-jp/tools/csv-to-csv/" />
  <link rel="alternate" hreflang="ja-jp" href="https://www.convertfilebox.net/ja-jp/ja-jp/tools/csv-to-csv/" />
  <link rel="alternate" hreflang="en-us" href="https://www.convertfilebox.net/en-us/tools/csv-to-csv/" />

  <!-- Styles -->
  <link rel="stylesheet" href="/assets/css/style.css">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">

  <!-- Shift-JIS support -->
  <script src="https://cdn.jsdelivr.net/npm/encoding-japanese@2.2.0/encoding.min.js"></script>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2739559953649909"
    crossorigin="anonymous"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2M7JXDP7J8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-2M7JXDP7J8');
  </script>

  <style>
    .form-select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 0.9375rem;
      background-color: white;
    }

    .split-pane {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    @media (min-width: 960px) {
      .split-pane {
        grid-template-columns: 1fr 1fr;
      }
    }

    /* 謚陦楢ｧ｣隱ｬ逕ｨ繧ｹ繧ｿ繧､繝ｫ */
    .technical-content {
      margin-top: 4rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border);
      line-height: 1.8;
    }

    .technical-content h2 {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      color: var(--text-main);
    }

    .technical-content h3 {
      font-size: 1.125rem;
      margin-top: 2rem;
      margin-bottom: 1rem;
      color: var(--text-main);
      border-left: 4px solid var(--primary);
      padding-left: 1rem;
    }

    .technical-content p {
      margin-bottom: 1rem;
      color: var(--text-muted);
    }

    .technical-content ul {
      margin-bottom: 1.5rem;
      padding-left: 1.5rem;
    }

    .technical-content li {
      margin-bottom: 0.5rem;
      color: var(--text-muted);
    }

    .technical-content strong {
      color: var(--text-main);
    }
  </style>
</head>

<body>

  <site-header></site-header>

  <main class="container mt-8 mb-8" style="max-width: 1280px;">
    <div class="text-center mb-8">
      <h1>CSV 譁・ｭ励さ繝ｼ繝牙､画鋤繝・・繝ｫ</h1>
      <p class="text-muted mt-2">
        Excel縺ｮ譁・ｭ怜喧縺托ｼ・hift-JIS・峨ｄ縲∵ｵｷ螟悶し繝ｼ繝薙せ縺ｮUTF-8蝠城｡後ｒ蜊ｳ蠎ｧ縺ｫ隗｣豎ｺ縲・br>
        繝励Λ繧､繝舌す繝ｼ驥崎ｦ悶・繝悶Λ繧ｦ繧ｶ螳檎ｵ占ｨｭ險医・
      </p>
      <div class="flex justify-center gap-4 mt-4">
        <span class="tag">繧ｵ繝ｼ繝舌・騾∽ｿ｡縺ｪ縺・/span>
      </div>
    </div>

    <!-- 繝・・繝ｫ繧ｨ繝ｪ繧｢ -->
    <label class="file-drop-area" id="dropArea" for="fileInput">
      <input type="file" id="fileInput" class="file-input" accept=".csv,text/csv,.txt,text/plain" />
      <div style="font-size: 2rem; color: var(--text-light); margin-bottom: 0.5rem;">唐</div>
      <p class="font-bold text-main">CSV繝輔ぃ繧､繝ｫ繧帝∈謚・縺ｾ縺溘・ 繝峨Λ繝・げ&繝峨Ο繝・・</p>
      <p class="text-sm text-muted mt-2">.csv, .txt (1GB遞句ｺｦ縺ｮ繝輔ぃ繧､繝ｫ縺ｾ縺ｧ蟇ｾ蠢懷庄閭ｽ)</p>
      <div id="fileInfo" class="alert alert-info inline-flex items-center gap-2 mt-4"
        style="display:none; text-align:left; margin-left:auto; margin-right:auto;">
        <span id="fileName"></span> <span class="text-xs opacity-75" id="fileSize"></span>
      </div>
    </label>

    <div class="tool-config-bar mb-6">
      <div class="form-group">
        <label class="text-xs font-bold text-muted" for="inEnc">1. 隱ｭ縺ｿ霎ｼ縺ｿ譁・ｭ励さ繝ｼ繝・/label>
        <select id="inEnc" class="form-select" disabled>
          <option value="shift_jis" selected>Shift-JIS (Excel遲・</option>
          <option value="utf-8">UTF-8 (讓呎ｺ・</option>
          <option value="utf-8-bom">UTF-8・・OM莉倥″・・/option>
          <option value="utf-16le">UTF-16LE</option>
          <option value="utf-16be">UTF-16BE</option>
        </select>
      </div>

      <div class="form-group">
        <label class="text-xs font-bold text-muted" for="outEnc">2. 蜃ｺ蜉帶枚蟄励さ繝ｼ繝・/label>
        <select id="outEnc" class="form-select" disabled>
          <option value="shift_jis" selected>Shift-JIS (Excel謗ｨ螂ｨ)</option>
          <option value="utf-8">UTF-8</option>
          <option value="utf-8-bom">UTF-8・・OM莉倥″・・/option>
        </select>
      </div>

      <div class="form-group">
        <label class="text-xs font-bold text-muted" for="eol">蜃ｺ蜉帶隼陦後さ繝ｼ繝・/label>
        <select id="eol" class="form-select" disabled>
          <option value="crlf" selected>CRLF (Windows)</option>
          <option value="lf">LF (Unix/Mac)</option>
        </select>
      </div>

      <div style="margin-left: auto;">
        <button class="btn btn-primary" id="btnDownload" disabled>螟画鋤縺励※繝繧ｦ繝ｳ繝ｭ繝ｼ繝・/button>
      </div>
    </div>
    <div id="warnBadge" class="alert alert-warning mt-4 text-xs" style="display:none"></div>

    <div class="split-pane">
      <!-- Preview Input -->
      <div class="flex flex-col gap-2">
        <div class="toolbar">
          <h2 class="text-lg font-bold">隱ｭ霎ｼ繝励Ξ繝薙Η繝ｼ</h2>
          <span id="inPreviewStat" class="text-xs text-muted"></span>
        </div>
        <textarea id="previewIn" class="code-editor" readonly style="height: 300px;"
          placeholder="縺薙％縺ｫ蜀・ｮｹ縺瑚｡ｨ遉ｺ縺輔ｌ縺ｾ縺・></textarea>
      </div>

      <!-- Preview Output -->
      <div class="flex flex-col gap-2">
        <div class="toolbar">
          <h2 class="text-lg font-bold">蜃ｺ蜉帙・繝ｬ繝薙Η繝ｼ</h2>
          <span id="outPreviewStat" class="text-xs text-muted"></span>
        </div>
        <textarea id="previewOut" class="code-editor" readonly style="height: 300px;"
          placeholder="螟画鋤蠕後・繧､繝｡繝ｼ繧ｸ縺瑚｡ｨ遉ｺ縺輔ｌ縺ｾ縺・></textarea>
      </div>
    </div>

    <div class="flex justify-center mt-4 text-xs text-muted">
      窶ｻ繝励Ξ繝薙Η繝ｼ縺ｯ蜈磯ｭ50陦後・縺ｿ陦ｨ遉ｺ縺輔ｌ縺ｾ縺吶・
    </div>

    <!-- 繧ｳ繝ｳ繝・Φ繝・ｼｷ蛹悶そ繧ｯ繧ｷ繝ｧ繝ｳ (AdSense蟇ｾ遲・ 1,000譁・ｭ嶺ｻ･荳翫・迢ｬ閾ｪ隗｣隱ｬ) -->
    <article class="technical-content">
      <h2>謚陦楢ｧ｣隱ｬ・咾SV縺ｮ譁・ｭ怜喧縺代→譁・ｭ励さ繝ｼ繝牙､画鋤縺ｮ莉慕ｵ・∩</h2>
      <p>
        譌･譛ｬ縺ｮIT繝薙ず繝阪せ迴ｾ蝣ｴ縺ｧ譛繧るｻ郢√↓驕ｭ驕・☆繧九ヨ繝ｩ繝悶Ν縺ｮ荳縺､縺後，SV繝輔ぃ繧､繝ｫ縺ｮ<strong>縲梧枚蟄怜喧縺代・/strong>縺ｧ縺吶ら音縺ｫ縲｀icrosoft
        Excel縺ｧCSV繧帝幕縺・◆髫帙↓譌･譛ｬ隱槭′隱ｭ繧√↑縺上↑繧狗樟雎｡縺ｯ縲∵枚蟄励さ繝ｼ繝峨・荳堺ｸ閾ｴ・医お繝ｳ繧ｳ繝ｼ繝・ぅ繝ｳ繧ｰ繝ｻ繝溘せ繝槭ャ繝・ｼ峨↓繧医▲縺ｦ蠑輔″襍ｷ縺薙＆繧後∪縺吶・
      </p>

      <h3>Shift-JIS縺ｨUTF-8縺ｮ邨ゅｏ繧峨↑縺・ｯｾ遶・/h3>
      <p>
        豁ｴ蜿ｲ逧・↑邨檎ｷｯ縺九ｉ縲∵律譛ｬ縺ｮWindows迺ｰ蠅・♀繧医・Excel縺ｯ莨晉ｵｱ逧・↓<code>Shift-JIS (CP932)</code>縺ｨ縺・≧譁・ｭ励さ繝ｼ繝峨ｒ讓呎ｺ悶→縺励※菴ｿ逕ｨ縺励※縺阪∪縺励◆縲ゆｸ譁ｹ縲∫樟莉｣縺ｮ繧ｦ繧ｧ繝悶し繝ｼ繝薙せ縲√せ繝槭・繝医ヵ繧ｩ繝ｳ繧｢繝励Μ縲√・繝ｭ繧ｰ繝ｩ繝溘Φ繧ｰ險隱橸ｼ・ython繧ЙavaScript遲会ｼ峨・螟壹￥縺ｯ縲∽ｸ也阜讓呎ｺ悶・譁・ｭ励さ繝ｼ繝峨〒縺ゅｋ<code>UTF-8</code>繧偵ョ繝輔か繝ｫ繝医→縺励※縺・∪縺吶・
      </p>
      <p>
        縺薙・縲後え繧ｧ繝悶°繧峨ム繧ｦ繝ｳ繝ｭ繝ｼ繝峨＠縺欟TF-8縺ｮCSV繧偵ヾhift-JIS縺縺ｨ諤昴＞霎ｼ繧薙〒縺・ｋExcel縺ｧ髢九￥縲阪→縺・≧繧ｺ繝ｬ縺後√≠縺ｮ迚ｹ蠕ｴ逧・↑縲後≠縺・≧縺医♀縲阪′縲古｣ﾂ・づ｣ﾂ・・｣ﾂ・・｣ﾂ・暗｣ﾂ・翫阪・繧医≧縺ｫ蛹悶￠繧句次蝗縺ｧ縺吶よ悽繝・・繝ｫ縺ｯ縲√％縺ｮ2縺､縺ｮ荳也阜繧偵す繝ｼ繝繝ｬ繧ｹ縺ｫ郢九＄縺薙→繧堤岼逧・→縺励※縺・∪縺吶・
      </p>

      <h3>BOM・・yte Order Mark・峨・蠖ｹ蜑ｲ縺ｨ驥崎ｦ∵ｧ</h3>
      <p>
        UTF-8縺ｮCSV縺ｫ縺ｯ縲沓OM・医・繝・峨阪→蜻ｼ縺ｰ繧後ｋ髫繧後◆繝・・繧ｿ・・繝舌う繝医・迚ｹ谿翫さ繝ｼ繝会ｼ峨ｒ霑ｽ蜉縺吶ｋ縺薙→縺後〒縺阪∪縺吶・OM縺御ｻ倥＞縺ｦ縺・ｋ縺ｨ縲・xcel縺ｯ縲後≠縲√％繧後・UTF-8縺縺ｪ縲阪→閾ｪ蜍慕噪縺ｫ蛻､譁ｭ縺励※豁｣縺励￥髢九￠繧九ｈ縺・↓縺ｪ繧翫∪縺吶・
      </p>
      <p>
        蠖薙ヤ繝ｼ繝ｫ縺ｧ縺ｯ縲ヾhift-JIS縺ｸ縺ｮ螟画鋤縺縺代〒縺ｪ縺上・strong>縲袈TF-8・・OM莉倥″・峨・/strong>縺ｸ縺ｮ螟画鋤繧ゅし繝昴・繝医＠縺ｦ縺・∪縺吶４hift-JIS縺ｧ縺ｯ陦ｨ迴ｾ縺ｧ縺阪↑縺Фnicode譁・ｭ暦ｼ育ｵｵ譁・ｭ励ｄ迚ｹ谿翫↑莠ｺ蜷阪↑縺ｩ・峨ｒ菫晄戟縺励▽縺､縲・xcel縺ｧ繧る幕縺代ｋ繧医≧縺ｫ縺励◆縺・ｴ蜷医↓縺ｯ縲ゞTF-8・・OM莉倥″・峨ｒ驕ｸ謚槭☆繧九・縺檎樟莉｣逧・↑譛驕ｩ隗｣縺ｧ縺吶・
      </p>

      <h3>蠕ｹ蠎輔＠縺溘け繝ｩ繧､繧｢繝ｳ繝医し繧､繝牙・逅・・螳牙・諤ｧ</h3>
      <p>
        CSV縺ｫ縺ｯ縲・｡ｧ螳｢蜷咲ｰｿ縲∝｣ｲ荳顔ｮ｡逅・∝惠蠎ｫ繝・・繧ｿ縺ｨ縺・▲縺滄撼蟶ｸ縺ｫ讖溷ｯ・ｧ縺ｮ鬮倥＞諠・ｱ縺悟性縺ｾ繧後∪縺吶ょ､壹￥縺ｮ繧ｪ繝ｳ繝ｩ繧､繝ｳ螟画鋤繧ｵ繧､繝医〒縺ｯ縲∽ｸ蠎ｦ繝輔ぃ繧､繝ｫ繧偵し繝ｼ繝舌・縺ｸ縲後い繝・・繝ｭ繝ｼ繝峨阪＠縺ｦ蜃ｦ逅・ｒ陦後＞縺ｾ縺吶′縲√％繧後・諠・ｱ縺ｮ螟夜Κ豬∝・縺ｨ縺・≧豺ｱ蛻ｻ縺ｪ繧ｻ繧ｭ繝･繝ｪ繝・ぅ繝ｪ繧ｹ繧ｯ繧剃ｼｴ縺・∪縺吶・
      </p>
      <p>
        ConvertFileBox縺ｮ譁・ｭ励さ繝ｼ繝牙､画鋤縺ｯ縲？TML5縺ｮ<code>File API</code>縺ｨ<code>encoding-japanese</code>繝ｩ繧､繝悶Λ繝ｪ繧呈ｴｻ逕ｨ縺励・strong>蜃ｦ逅・・100%繧偵≠縺ｪ縺溘・繝悶Λ繧ｦ繧ｶ繝｡繝｢繝ｪ蜀・〒陦後＞縺ｾ縺吶・/strong>
        繝輔ぃ繧､繝ｫ縺悟ｽ薙し繧､繝医・繧ｵ繝ｼ繝舌・縺ｫ騾∽ｿ｡縺輔ｌ繧九％縺ｨ縺ｯ迚ｩ逅・噪縺ｫ縺ゅｊ縺ｾ縺帙ｓ縲よｩ溷ｯ・ュ蝣ｱ縺ｮ譁・ｭ怜喧縺代ｒ豐ｻ縺励◆縺・ン繧ｸ繝阪せ繝槭Φ縺後∵怙繧ょｮ牙ｿ・＠縺ｦ菴ｿ縺医ｋ繝・・繝ｫ繧堤岼謖・＠縺ｾ縺励◆縲・
      </p>

      <h3>繧医￥縺ゅｋ雉ｪ蝠・(FAQ)</h3>
      <div class="mt-4">
        <h4 class="font-bold">Q. 繝輔ぃ繧､繝ｫ繧ｵ繧､繧ｺ縺ｮ荳企剞縺ｯ縺ゅｊ縺ｾ縺吶°・・/h4>
        <p class="text-sm">A. 繝悶Λ繧ｦ繧ｶ縺ｮ蛻ｶ髯舌↓繧医ｊ縺ｾ縺吶′縲・壼ｸｸ1GB遞句ｺｦ縺ｮ螟ｧ縺阪↑CSV繝輔ぃ繧､繝ｫ縺ｾ縺ｧ繝｡繝｢繝ｪ荳翫〒螟画鋤蜿ｯ閭ｽ縺ｧ縺吶ゅ◆縺縺励√・繝ｬ繝薙Η繝ｼ陦ｨ遉ｺ縺ｯ蜃ｦ逅・ｒ霆ｽ縺上☆繧九◆繧∝・鬆ｭ50陦後↓髯仙ｮ壹＠縺ｦ縺・∪縺吶・/p>

        <h4 class="font-bold">Q. 螟画鋤縺励※繧よ枚蟄怜喧縺代′逶ｴ繧翫∪縺帙ｓ縲・/h4>
        <p class="text-sm">A. 縲瑚ｪｭ縺ｿ霎ｼ縺ｿ譁・ｭ励さ繝ｼ繝峨阪・險ｭ螳壹′髢馴＆縺｣縺ｦ縺・ｋ蜿ｯ閭ｽ諤ｧ縺後≠繧翫∪縺吶ゅ・繝ｬ繝薙Η繝ｼ逕ｻ髱｢縺ｧ譁・ｭ励′豁｣縺励￥陦ｨ遉ｺ縺輔ｌ繧九∪縺ｧ縲∬ｪｭ縺ｿ霎ｼ縺ｿ險ｭ螳夲ｼ・hift-JIS縺偽TF-8縺具ｼ峨ｒ蛻・ｊ譖ｿ縺医※縺ｿ縺ｦ縺上□縺輔＞縲・
        </p>

        <h4 class="font-bold">Q. 邨ｵ譁・ｭ励′豸医∴縺ｦ縺励∪縺・∪縺励◆縲・/h4>
        <p class="text-sm">A. 蜃ｺ蜉帶枚蟄励さ繝ｼ繝峨↓Shift-JIS繧帝∈謚槭☆繧九→縲ゞnicode縺ｫ縺励°縺ｪ縺・枚蟄暦ｼ育ｵｵ譁・ｭ励↑縺ｩ・峨・邯ｭ謖√〒縺阪∪縺帙ｓ縲ゅ◎縺ｮ蝣ｴ蜷医・縲袈TF-8・・OM莉倥″・峨阪∈螟画鋤縺励※縺上□縺輔＞縲・/p>
      </div>

      <h3 class="mt-8">謚陦鍋噪縺ｪ縺薙□繧上ｊ・壽隼陦後さ繝ｼ繝峨・蛻ｶ蠕｡</h3>
      <p>
        譛ｬ繝・・繝ｫ縺ｧ縺ｯ譁・ｭ励さ繝ｼ繝峨□縺代〒縺ｪ縺上∵隼陦後さ繝ｼ繝峨・螟画鋤・・RLF /
        LF・峨ｂ蜷梧凾縺ｫ陦後∴縺ｾ縺吶８indows迺ｰ蠅・〒縺ゅｌ縺ｰCRLF縲ゞnix/Mac迺ｰ蠅・ｄ譛霑代・繝励Ο繧ｰ繝ｩ繝溘Φ繧ｰ迺ｰ蠅・〒縺ゅｌ縺ｰLF繧帝∈謚槭☆繧九％縺ｨ縺ｧ縲√す繧ｹ繝・Β髢薙・繝・・繧ｿ遘ｻ陦後ｒ繧医ｊ繧ｹ繝繝ｼ繧ｺ縺ｫ縺励∪縺吶・
      </p>
    </article>

  </main>

  <site-footer></site-footer>

  <script src="/assets/js/ui.js"></script>

  </main>

  <footer class="site-footer">
    <div class="container text-center">
      <div class="flex justify-center gap-4 mb-4 text-sm text-muted">
        <a href="/ja-jp/tools/">繝・・繝ｫ荳隕ｧ</a>
        <a href="/ja-jp/about/">縺薙・繧ｵ繧､繝医↓縺､縺・※</a>
        <a href="/ja-jp/privacy/">繝励Λ繧､繝舌す繝ｼ繝昴Μ繧ｷ繝ｼ</a>
      </div>
      <div class="text-xs text-muted">
        &copy; <span id="year">2026</span> ConvertFileBox. <br>
        螟画鋤邨先棡縺ｮ豁｣遒ｺ諤ｧ縺ｯ菫晁ｨｼ縺励∪縺帙ｓ・郁・蟾ｱ雋ｬ莉ｻ縺ｧ縺泌茜逕ｨ縺上□縺輔＞・峨・
      </div>
    </div>
  </footer>

  <script src="/assets/js/ui.js"></script>
  <script>
    const $ = (id) => document.getElementById(id);

    const fileInputEl = $("fileInput");
    const dropArea = $("dropArea");
    const fileInfoEl = $("fileInfo");
    const fileNameEl = $("fileName");
    const fileSizeEl = $("fileSize");

    const inEncEl = $("inEnc");
    const outEncEl = $("outEnc");
    const eolEl = $("eol");

    const btnDownload = $("btnDownload");

    const previewInEl = $("previewIn");
    const previewOutEl = $("previewOut");
    const inPreviewStatEl = $("inPreviewStat");
    const outPreviewStatEl = $("outPreviewStat");
    const warnBadgeEl = $("warnBadge");

    let lastSelectedFile = null;
    let lastOutputBytes = null;
    let lastOutputName = "converted.csv";

    function showWarn(text) {
      if (!text) {
        warnBadgeEl.style.display = "none";
        warnBadgeEl.textContent = "";
        return;
      }
      warnBadgeEl.style.display = "block";
      warnBadgeEl.textContent = text;
    }

    function normalizeToLF(s) {
      return s.replace(/\r\n/g, "\n").replace(/\r/g, "\n");
    }
    function applyEol(s, eol) {
      const lf = normalizeToLF(s);
      return (eol === "crlf") ? lf.replace(/\n/g, "\r\n") : lf;
    }

    function decodeArrayBuffer(buf, encSel) {
      const enc = (encSel === "utf-8-bom") ? "utf-8" : encSel;
      let text = "";
      try {
        text = new TextDecoder(enc, { fatal: false }).decode(buf);
      } catch (e) {
        text = new TextDecoder("utf-8", { fatal: false }).decode(buf);
      }
      if (text.startsWith("\uFEFF")) text = text.slice(1);
      return text.replace(/\u0000/g, "");
    }

    function encodeToBytes(text, outEnc) {
      if (outEnc === "utf-8" || outEnc === "utf-8-bom") {
        const u8 = new TextEncoder().encode(text);
        if (outEnc === "utf-8-bom") {
          const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
          const merged = new Uint8Array(bom.length + u8.length);
          merged.set(bom, 0);
          merged.set(u8, bom.length);
          return merged;
        }
        return u8;
      }

      if (outEnc === "shift_jis") {
        if (!window.Encoding || !Encoding.stringToCode) {
          throw new Error("Shift-JIS譖ｸ縺榊・縺礼畑繝ｩ繧､繝悶Λ繝ｪ縺瑚ｪｭ縺ｿ霎ｼ繧√∪縺帙ｓ縺ｧ縺励◆縲・);
        }
        const unicodeCodes = Encoding.stringToCode(text);
        const sjisCodes = Encoding.convert(unicodeCodes, "SJIS", "UNICODE");
        return new Uint8Array(sjisCodes);
      }

      return new TextEncoder().encode(text);
    }

    function decodeBytes(bytes, enc) {
      if (enc === "shift_jis") {
        if (!window.Encoding || !Encoding.convert || !Encoding.codeToString) {
          return "・・hift-JIS繝励Ξ繝薙Η繝ｼ逕ｨ繝ｩ繧､繝悶Λ繝ｪ縺後≠繧翫∪縺帙ｓ・・;
        }
        const codes = Array.from(bytes);
        const unicodeCodes = Encoding.convert(codes, "UNICODE", "SJIS");
        return Encoding.codeToString(unicodeCodes);
      }
      let t = new TextDecoder("utf-8", { fatal: false }).decode(bytes);
      if (t.startsWith("\uFEFF")) t = t.slice(1);
      return t.replace(/\u0000/g, "");
    }

    function makePreview(text) {
      const lf = normalizeToLF(text);
      const lines = lf.split("\n");
      const head = lines.slice(0, 50).join("\n");
      const more = lines.length > 50 ? `\n\n...・亥・${lines.length}陦御ｸｭ縲∝・鬆ｭ50陦後ｒ陦ｨ遉ｺ・荏 : "";
      return head + more;
    }

    function buildOutputName(originalName, outEnc) {
      const base = (originalName || "converted").replace(/\.[^.]+$/, "");
      const suffix = (outEnc === "shift_jis") ? "sjis"
        : (outEnc === "utf-8-bom") ? "utf8bom"
          : "utf8";
      return `${base}.${suffix}.csv`;
    }

    async function reloadAndConvert() {
      if (!lastSelectedFile) return;

      // File Info update
      fileInfoEl.style.display = "inline-flex";
      fileNameEl.textContent = lastSelectedFile.name;
      const sizeKB = Math.round(lastSelectedFile.size / 1024);
      fileSizeEl.textContent = `(${sizeKB}KB)`;

      showWarn("");

      try {
        const ab = await lastSelectedFile.arrayBuffer();

        // 1) 蜈･蜉帶枚蟄励さ繝ｼ繝峨〒 decode
        const inText = decodeArrayBuffer(ab, inEncEl.value);

        // 蜈･蜉帙・繝ｬ繝薙Η繝ｼ
        previewInEl.value = makePreview(inText);
        inPreviewStatEl.textContent = `隱ｭ霎ｼ: ${inEncEl.options[inEncEl.selectedIndex].text}`;

        // 2) 蜃ｺ蜉帷畑螟画鋤
        const outText = applyEol(inText, eolEl.value);
        const outBytes = encodeToBytes(outText, outEncEl.value);

        // 蜃ｺ蜉帙・繝ｬ繝薙Η繝ｼ
        const outTextForPreview = decodeBytes(outBytes, outEncEl.value);
        previewOutEl.value = makePreview(outTextForPreview);
        outPreviewStatEl.textContent = `蜃ｺ蜉・ ${outEncEl.options[outEncEl.selectedIndex].text}`;

        // 隴ｦ蜻翫メ繧ｧ繝・け
        if (outEncEl.value === "shift_jis" && outTextForPreview !== outText) {
          showWarn("豕ｨ諢・ Shift-JIS縺ｧ陦ｨ迴ｾ縺ｧ縺阪↑縺・枚蟄暦ｼ育ｵｵ譁・ｭ励↑縺ｩ・峨′蜷ｫ縺ｾ繧後※縺・∪縺吶ゅ◎繧後ｉ縺ｮ譁・ｭ励・鄂ｮ謠帙∪縺溘・蜑企勁縺輔ｌ繧句庄閭ｽ諤ｧ縺後≠繧翫∪縺吶・);
        }

        lastOutputBytes = outBytes;
        lastOutputName = buildOutputName(lastSelectedFile.name, outEncEl.value);

        btnDownload.disabled = false;

      } catch (e) {
        console.error(e);
        lastOutputBytes = null;
        btnDownload.disabled = true;
        previewInEl.value = "繧ｨ繝ｩ繝ｼ縺檎匱逕溘＠縺ｾ縺励◆";
        previewOutEl.value = "";
        showWarn("螟画鋤縺ｫ螟ｱ謨励＠縺ｾ縺励◆縲ゅΛ繧､繝悶Λ繝ｪ縺ｮ隱ｭ縺ｿ霎ｼ縺ｿ迥ｶ豕√↑縺ｩ繧堤｢ｺ隱阪＠縺ｦ縺上□縺輔＞縲・);
      }
    }

    // Drag & Drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropArea.addEventListener(eventName, preventDefaults, false);
    });
    function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }
    ['dragenter', 'dragover'].forEach(eventName => {
      dropArea.addEventListener(eventName, () => dropArea.classList.add('dragover'), false);
    });
    ['dragleave', 'drop'].forEach(eventName => {
      dropArea.addEventListener(eventName, () => dropArea.classList.remove('dragover'), false);
    });

    dropArea.addEventListener('drop', (e) => {
      const dt = e.dataTransfer;
      const files = dt.files;
      if (files && files[0]) {
        fileInputEl.files = files;
        handleFile(files[0]);
      }
    });

    fileInputEl.addEventListener("change", async (e) => {
      const f = e.target.files && e.target.files[0];
      if (f) handleFile(f);
    });

    function handleFile(f) {
      lastSelectedFile = f;
      inEncEl.disabled = false;
      outEncEl.disabled = false;
      eolEl.disabled = false;
      reloadAndConvert();
    }

    inEncEl.addEventListener("change", reloadAndConvert);
    eolEl.addEventListener("change", reloadAndConvert);
    outEncEl.addEventListener("change", reloadAndConvert);

    btnDownload.addEventListener("click", () => {
      if (!lastOutputBytes) return;
      const blob = new Blob([lastOutputBytes], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = lastOutputName;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });
  </script>
</body>

</html>

